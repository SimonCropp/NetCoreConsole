<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /readme.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

This shows how to use the various publish options when building a netcore 3 console app.

<!-- toc -->
## Contents

  * [Console project settings](#console-project-settings)
  * [Publish Profiles](#publish-profiles)
    * [Default](#default)
    * [Framework Dependent](#framework-dependent)
    * [Single File](#single-file)
    * [Single File and Framework Dependent](#single-file-and-framework-dependent)
    * [Trimmed](#trimmed)
    * [Single File and Trimmed](#single-file-and-trimmed)
  * [ReadyToRun images](#readytorun-images)
  * [Further Reading](#further-reading)<!-- endtoc -->


## Console project settings

 * This sample references and makes use of NodaTime to illustrate a dependency being consumed.
 * This sample references, but does not use, Newtonsoft to illustrate a dependency being trimmed.
 * The [Runtime IDentifier](https://docs.microsoft.com/en-us/dotnet/core/rid-catalog) is hard coded to `win10-x64`. All profiles will inherit this setting.
 * `PublishDir` is set to `src\MyConsole\publish\$(PublishProfile)\`.

<!-- snippet: MyConsole.csproj -->
<a id='snippet-MyConsole.csproj'/></a>
```csproj
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>netcoreapp3.1</TargetFramework>
    <RuntimeIdentifier>win10-x64</RuntimeIdentifier>
    <PublishDir>publish\$(PublishProfile)\</PublishDir>
  </PropertyGroup>
  <ItemGroup>
    <Content Include="ContentFile.txt">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </Content>
    <PackageReference Include="Newtonsoft.Json" Version="12.0.3" />
    <PackageReference Include="NodaTime" Version="2.4.7" />
    <PackageReference Include="System.Configuration.ConfigurationManager" Version="4.7.0" />
  </ItemGroup>
</Project>
```
<sup><a href='/src/MyConsole/MyConsole.csproj#L1-L16' title='File snippet `MyConsole.csproj` was extracted from'>snippet source</a> | <a href='#snippet-MyConsole.csproj' title='Navigate to start of snippet `MyConsole.csproj`'>anchor</a></sup>
<!-- endsnippet -->


## Publish Profiles

Publish options are stored in [Publish Profiles](https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/visual-studio-publish-profiles?view=aspnetcore-3.0) and are located in [src/MyConsole/Properties/PublishProfiles](/src/MyConsole/Properties/PublishProfiles)


### Default

Uses an empty (default) publish profile:

<!-- snippet: Default.pubxml -->
<a id='snippet-Default.pubxml'/></a>
```pubxml
<Project>
  <PropertyGroup>
  </PropertyGroup>
</Project>
```
<sup><a href='/src/MyConsole/Properties/PublishProfiles/Default.pubxml#L1-L4' title='File snippet `Default.pubxml` was extracted from'>snippet source</a> | <a href='#snippet-Default.pubxml' title='Navigate to start of snippet `Default.pubxml`'>anchor</a></sup>
<!-- endsnippet -->

 <!-- include: Default. path: /src/includes/Default.include.md -->
 * Files: 234
 * Size: 71.3 MB <!-- end include: Default. path: /src/includes/Default.include.md -->

Publish Command:

```
dotnet publish MyConsole\MyConsole.csproj -c Release /p:PublishProfile=Default
```


### Framework Dependent

Same as the [Default](#default) but makes it [Framework-dependent](https://docs.microsoft.com/en-us/dotnet/core/deploying/#framework-dependent-deployments-fdd).

> For an FDD, you deploy only your app and third-party dependencies. Your app will use the version of .NET Core that's present on the target system. 

<!-- snippet: Fdd.pubxml -->
<a id='snippet-Fdd.pubxml'/></a>
```pubxml
<Project>
  <PropertyGroup>
    <SelfContained>false</SelfContained>
  </PropertyGroup>
</Project>
```
<sup><a href='/src/MyConsole/Properties/PublishProfiles/Fdd.pubxml#L1-L5' title='File snippet `Fdd.pubxml` was extracted from'>snippet source</a> | <a href='#snippet-Fdd.pubxml' title='Navigate to start of snippet `Fdd.pubxml`'>anchor</a></sup>
<!-- endsnippet -->

 <!-- include: Fdd. path: /src/includes/Fdd.include.md -->
 * Files: 14
 * Size: 2.36 MB <!-- end include: Fdd. path: /src/includes/Fdd.include.md -->

Notes:

 * Depends on an installed runtime.

Publish Command:

```
dotnet publish MyConsole\MyConsole.csproj -c Release /p:PublishProfile=Fdd
```


### Single File

Same as [Default](#default) but creates a [Single-file executables](https://docs.microsoft.com/en-us/dotnet/core/whats-new/dotnet-core-3-0#single-file-executables).

> The executable is self-extracting and contains all dependencies (including native) that are required to run your app. When the app is first run, the application is extracted to a directory based on the app name and build identifier. Startup is faster when the application is run again. The application doesn't need to extract itself a second time unless a new version was used.

<!-- snippet: SingleFile.pubxml -->
<a id='snippet-SingleFile.pubxml'/></a>
```pubxml
<Project>
  <PropertyGroup>
    <PublishSingleFile>true</PublishSingleFile>
  </PropertyGroup>
</Project>
```
<sup><a href='/src/MyConsole/Properties/PublishProfiles/SingleFile.pubxml#L1-L5' title='File snippet `SingleFile.pubxml` was extracted from'>snippet source</a> | <a href='#snippet-SingleFile.pubxml' title='Navigate to start of snippet `SingleFile.pubxml`'>anchor</a></sup>
<!-- endsnippet -->

 <!-- include: SingleFile. path: /src/includes/SingleFile.include.md -->
 * Files: 1
 * Size: 71.32 MB <!-- end include: SingleFile. path: /src/includes/SingleFile.include.md -->

Notes:

Publish Command:

```
dotnet publish MyConsole\MyConsole.csproj -c Release /p:PublishProfile=SingleFile
```


### Single File and Framework Dependent

Combines [Single-File](#single-file) and [Framework Dependent](#framework-dependent).

<!-- snippet: SingleFileFdd.pubxml -->
<a id='snippet-SingleFileFdd.pubxml'/></a>
```pubxml
<Project>
  <PropertyGroup>
    <PublishSingleFile>true</PublishSingleFile>
    <SelfContained>false</SelfContained>
  </PropertyGroup>
</Project>
```
<sup><a href='/src/MyConsole/Properties/PublishProfiles/SingleFileFdd.pubxml#L1-L6' title='File snippet `SingleFileFdd.pubxml` was extracted from'>snippet source</a> | <a href='#snippet-SingleFileFdd.pubxml' title='Navigate to start of snippet `SingleFileFdd.pubxml`'>anchor</a></sup>
<!-- endsnippet -->

 <!-- include: SingleFileFdd. path: /src/includes/SingleFileFdd.include.md -->
 * Files: 1
 * Size: 2.36 MB <!-- end include: SingleFileFdd. path: /src/includes/SingleFileFdd.include.md -->

Notes:

 * Depends on an installed runtime.

Publish Command:

```
dotnet publish MyConsole\MyConsole.csproj -c Release /p:PublishProfile=SingleFileFdd
```


### Trimmed

Same as the [Default](#default) but uses [assembly-linking](https://docs.microsoft.com/en-us/dotnet/core/whats-new/dotnet-core-3-0#assembly-linking).

> The .NET core 3.0 SDK comes with a tool that can reduce the size of apps by analyzing IL and trimming unused assemblies. Self-contained apps include everything needed to run your code, without requiring .NET to be installed on the host computer. However, many times the app only requires a small subset of the framework to function, and other unused libraries could be removed.

<!-- snippet: Trimmed.pubxml -->
<a id='snippet-Trimmed.pubxml'/></a>
```pubxml
<Project>
  <PropertyGroup>
    <PublishTrimmed>true</PublishTrimmed>
  </PropertyGroup>
</Project>
```
<sup><a href='/src/MyConsole/Properties/PublishProfiles/Trimmed.pubxml#L1-L5' title='File snippet `Trimmed.pubxml` was extracted from'>snippet source</a> | <a href='#snippet-Trimmed.pubxml' title='Navigate to start of snippet `Trimmed.pubxml`'>anchor</a></sup>
<!-- endsnippet -->

 <!-- include: Trimmed. path: /src/includes/Trimmed.include.md -->
 * Files: 124
 * Size: 38.44 MB <!-- end include: Trimmed. path: /src/includes/Trimmed.include.md -->

Publish Command:

```
dotnet publish MyConsole\MyConsole.csproj -c Release /p:PublishProfile=Trimmed
```


### Single File and Trimmed

Combines [Single File](#single-file) and [Trimmed](#trimmed):

<!-- snippet: SingleFileTrimmed.pubxml -->
<a id='snippet-SingleFileTrimmed.pubxml'/></a>
```pubxml
<Project>
  <PropertyGroup>
    <PublishSingleFile>true</PublishSingleFile>
    <PublishTrimmed>true</PublishTrimmed>
  </PropertyGroup>
</Project>
```
<sup><a href='/src/MyConsole/Properties/PublishProfiles/SingleFileTrimmed.pubxml#L1-L6' title='File snippet `SingleFileTrimmed.pubxml` was extracted from'>snippet source</a> | <a href='#snippet-SingleFileTrimmed.pubxml' title='Navigate to start of snippet `SingleFileTrimmed.pubxml`'>anchor</a></sup>
<!-- endsnippet -->

 <!-- include: SingleFileTrimmed. path: /src/includes/SingleFileTrimmed.include.md -->
 * Files: 1
 * Size: 38.45 MB <!-- end include: SingleFileTrimmed. path: /src/includes/SingleFileTrimmed.include.md -->

Publish Command:

```
dotnet publish MyConsole\MyConsole.csproj -c Release /p:PublishProfile=SingleFileTrimmed
```


## ReadyToRun images

ReadyToRun images (`<PublishReadyToRun>true</PublishReadyToRun>`) are not covered in the above scenarios, but should be considered as an option for production apps.

> R2R binaries improve startup performance by reducing the amount of work the JIT needs to do as your application is loading. The binaries contain similar native code as what the JIT would produce, giving the JIT a bit of a vacation when performance matters most (at startup). R2R binaries are larger because they contain both intermediate language (IL) code, which is still needed for some scenarios, and the native version of the same code, to improve startup. - https://devblogs.microsoft.com/dotnet/announcing-net-core-3-0/


## Further Reading

 * [Announcing .NET Core 3.0](https://devblogs.microsoft.com/dotnet/announcing-net-core-3-0/)
 * [What's new in .NET Core 3.0](https://docs.microsoft.com/en-us/dotnet/core/whats-new/dotnet-core-3-0)
 * [Making a tiny .NET Core 3.0 entirely self-contained single executable - Scott Hanselman](https://www.hanselman.com/blog/MakingATinyNETCore30EntirelySelfcontainedSingleExecutable.aspx)
 * [Create a Trimmed Self-Contained Single Executable in .NET Core 3.0](https://www.talkingdotnet.com/create-trimmed-self-contained-executable-in-net-core-3-0/)
